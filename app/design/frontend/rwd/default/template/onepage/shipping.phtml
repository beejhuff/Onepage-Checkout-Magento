<?php
/**
 * Oggetto Web checkout extension for Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Open Software License (OSL 3.0)
 * that is bundled with this package in the file LICENSE.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/osl-3.0.php
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade
 * the Oggetto OnepageCheckout module to newer versions in the future.
 * If you wish to customize the Oggetto OnepageCheckout module for your needs
 * please refer to http://www.magentocommerce.com for more information.
 *
 * @category   design
 * @package    rwd_default
 * @copyright  Copyright (C) 2014 Oggetto Web ltd (http://oggettoweb.com/)
 * @license    http://opensource.org/licenses/osl-3.0.php  Open Software License (OSL 3.0)
 */
/**
 * @var Oggetto_OnepageCheckout_Block_Onepage_Shipping $this
 */
?>
<h2 class="block__title"><?php echo $this->__('Shipping Address'); ?></h2>
<div class="form__row">
    <label class="required" for="shipping:firstname"><?php echo $this->__('First Name'); ?></label>
    <input class="input-text input" type="text" name="shipping[firstname]" id="shipping:firstname" value="<?php echo $this->getAddress()->getFirstname(); ?>" />
</div>
<div class="form__row">
    <label class="required" for="shipping:lastname"><?php echo $this->__('Last Name'); ?></label>
    <input class="input-text input" type="text" name="shipping[lastname]" id="shipping:lastname"  value="<?php echo $this->getAddress()->getLastname(); ?>" />
</div>
<?php if ($conf = $this->getAddressFieldConfig('company')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:company"><?php echo $this->__('Company'); ?></label>
        <input class="input-text input" type="text" name="shipping[company]" id="shipping:company" value="<?php echo $this->getAddress()->getCompany(); ?>"/>
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('street')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:street1"><?php echo $this->__('Street'); ?></label>
        <input class="input-text input" type="text" name="shipping[street][]" id="shipping:street1" value="<?php echo $this->getAddress()->getStreet(1); ?>" />
        <input class="input-text input" type="text" name="shipping[street][]" id="shipping:street2" value="<?php echo $this->getAddress()->getStreet(2); ?>" />
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('postcode')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:postcode"><?php echo $this->__('Zip/Postal Code'); ?></label>
        <input class="input-text input" type="text" name="shipping[postcode]" id="shipping:postcode" value="<?php echo $this->getAddress()->getPostcode(); ?>" />
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('city')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:city"><?php echo $this->__('City'); ?></label>
        <input class="input-text input" type="text" name="shipping[city]" id="shipping:city" value="<?php echo $this->getAddress()->getCity(); ?>" />
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('country_id')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:country_id"><?php echo $this->__('Country'); ?></label>
        <?php echo $this->getCountryHtmlSelect('shipping'); ?>
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('region')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:region_id"><?php echo $this->__('State/Province'); ?></label>
        <select id="shipping:region_id" name="shipping[region_id]" title="<?php echo $this->__('State/Province') ?>"
                class="validate-select input input_select" style="display:none;">
            <option value=""><?php echo $this->__('Please select region, state or province') ?></option>
        </select>
        <script type="text/javascript">
            //<![CDATA[
            $('shipping:region_id').setAttribute('defaultValue',  "<?php echo $this->getAddress()->getRegionId() ?>");
            //]]>
        </script>
        <input type="text" id="shipping:region" name="shipping[region]" value="<?php echo $this->escapeHtml($this->getAddress()->getRegion()) ?>"
               title="<?php echo $this->__('State/Province') ?>"
               class="input-text <?php echo $this->helper('customer/address')->getAttributeValidationClass('region') ?> input"
               style="display:none;" autocomplete="off"/>
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('telephone')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:telephone"><?php echo $this->__('Telephone'); ?></label>
        <input class="input-text input" type="text" name="shipping[telephone]" id="shipping:telephone" value="<?php echo $this->getAddress()->getTelephone(); ?>" />
    </div>
<?php endif; ?>
<?php if ($conf = $this->getAddressFieldConfig('fax')): ?>
    <?php $req = $conf == 'req' ? 'required' : ''; ?>
    <div class="form__row">
        <label class="<?php echo $req; ?>" for="shipping:fax"><?php echo $this->__('Fax'); ?></label>
        <input class="input-text input" type="text" name="shipping[fax]" id="shipping:fax" value="<?php echo $this->getAddress()->getFax(); ?>" />
    </div>
<?php endif; ?>

<?php ///** @var Mage_Customer_Block_Widget_Taxvat $_taxvat */ ?>
<?php //$_taxvat = $this->getLayout()->createBlock('onepageCheckout/onepage_billing_taxvat'); ?>
<?php //if ($_taxvat->isEnabled()): ?>
<!--    <div class="form__row">-->
<!--        <label for="shipping:taxvat">--><?php //echo $this->__('Tax/VAT Number'); ?><!--</label>-->
<!--        <input class="input-text input" type="text" name="shipping[taxvat]" id="shipping:taxvat" value="--><?php //echo $_taxvat->getTaxvat(); ?><!--" />-->
<!--    </div>-->
<?php //endif; ?>
<script type="text/javascript">
    var shippingAjaxSaveOn = [
        <?php if ($this->shouldReloadShippingMethodsOnCountryChange()) echo "'country_id'"; ?>,
        <?php if ($this->shouldReloadShippingMethodsOnRegionChange()) echo "'region', 'region_id'"; ?>,
        <?php if ($this->shouldReloadShippingMethodsOnPostalCodeChange()) echo "'postcode'"; ?>
    ];

    shippingAjaxSaveOn = shippingAjaxSaveOn.filter(function (el) { return el; });

    var shippingRegionUpdater = new RegionUpdater(
        'shipping:country_id',
        'shipping:region',
        'shipping:region_id',
        <?php echo $this->helper('directory')->getRegionJson() ?>,
        undefined,
        'shipping:postcode'
    );
</script>
